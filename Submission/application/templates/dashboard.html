{% extends "base.html" %}

{% block content %}
<h1>Status Dashboard</h1>

<div class="card">
    <h2>Process Assignments Overview</h2>
    
    {% if assignments %}
    <table class="table">
        <thead>
            <tr>
                <th>Customer Name</th>
                <th>Process Name</th>
                <th>Assignment Date</th>
                <th>Documents</th>
                <th>Progress</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for assignment in assignments %}
            <tr>
                <td>{{ assignment.customer_name }}</td>
                <td>{{ assignment.process_name }}</td>
                <td>{{ assignment.assignment_date.split(' ')[0] }}</td>
                <td>
                    <span style="font-weight: bold;">{{ assignment.documents_submitted }}</span> / 
                    <span>{{ assignment.documents_required }}</span>
                </td>
                <td>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="progress-bar" style="flex: 1; min-width: 100px;">
                            <div class="progress-fill" style="width: {{ assignment.completion_percentage }}%;"></div>
                        </div>
                        <span style="font-weight: bold; min-width: 35px;">{{ assignment.completion_percentage }}%</span>
                    </div>
                </td>
                <td>
                    {% if assignment.completion_percentage == 100 %}
                        <span class="status-badge status-completed">Completed</span>
                    {% elif assignment.completion_percentage > 0 %}
                        <span class="status-badge status-pending">In Progress</span>
                    {% else %}
                        <span class="status-badge status-not-started">Not Started</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <!-- Summary Statistics -->
    <div style="margin-top: 40px;">
        <h3>Summary Statistics</h3>
        <div class="grid grid-3" style="margin-top: 20px;">
            {% set total_assignments = assignments|length %}
            {% set completed_assignments = assignments|selectattr('completion_percentage', 'equalto', 100)|list|length %}
            {% set in_progress_assignments = assignments|selectattr('completion_percentage', 'greaterthan', 0)|selectattr('completion_percentage', 'lessthan', 100)|list|length %}
            {% set not_started_assignments = assignments|selectattr('completion_percentage', 'equalto', 0)|list|length %}
            
            <div class="card" style="text-align: center;">
                <div style="font-size: 48px; color: #28a745; margin-bottom: 10px;">{{ completed_assignments }}</div>
                <div style="color: #666; font-weight: bold;">Completed</div>
                <div style="color: #999; font-size: 14px;">
                    {{ "%.1f"|format((completed_assignments / total_assignments * 100) if total_assignments > 0 else 0) }}% of total
                </div>
            </div>
            
            <div class="card" style="text-align: center;">
                <div style="font-size: 48px; color: #ffc107; margin-bottom: 10px;">{{ in_progress_assignments }}</div>
                <div style="color: #666; font-weight: bold;">In Progress</div>
                <div style="color: #999; font-size: 14px;">
                    {{ "%.1f"|format((in_progress_assignments / total_assignments * 100) if total_assignments > 0 else 0) }}% of total
                </div>
            </div>
            
            <div class="card" style="text-align: center;">
                <div style="font-size: 48px; color: #dc3545; margin-bottom: 10px;">{{ not_started_assignments }}</div>
                <div style="color: #666; font-weight: bold;">Not Started</div>
                <div style="color: #999; font-size: 14px;">
                    {{ "%.1f"|format((not_started_assignments / total_assignments * 100) if total_assignments > 0 else 0) }}% of total
                </div>
            </div>
        </div>
    </div>
    
    <!-- Progress Distribution -->
    <div style="margin-top: 40px;">
        <h3>Progress Distribution</h3>
        <div style="display: flex; height: 20px; border-radius: 10px; overflow: hidden; margin: 20px 0;">
            {% if total_assignments > 0 %}
            <div style="background: #28a745; width: {{ (completed_assignments / total_assignments * 100) }}%; height: 100%;"></div>
            <div style="background: #ffc107; width: {{ (in_progress_assignments / total_assignments * 100) }}%; height: 100%;"></div>
            <div style="background: #dc3545; width: {{ (not_started_assignments / total_assignments * 100) }}%; height: 100%;"></div>
            {% else %}
            <div style="background: #e9ecef; width: 100%; height: 100%;"></div>
            {% endif %}
        </div>
        <div style="display: flex; justify-content: space-between; font-size: 14px; color: #666;">
            <span>ðŸŸ¢ Completed ({{ completed_assignments }})</span>
            <span>ðŸŸ¡ In Progress ({{ in_progress_assignments }})</span>
            <span>ðŸ”´ Not Started ({{ not_started_assignments }})</span>
        </div>
    </div>
    
    {% else %}
    <div style="text-align: center; padding: 60px; color: #666;">
        <div style="font-size: 48px; margin-bottom: 20px;">ðŸ“‹</div>
        <h3>No Process Assignments Found</h3>
        <p style="margin: 20px 0;">Start by adding customers and assigning them to processes.</p>
        <a href="{{ url_for('customers') }}" class="btn">Add Customers</a>
    </div>
    {% endif %}
</div>
{% endblock %}